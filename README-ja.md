# TEPA

[![test](https://github.com/arowM/tepa/actions/workflows/test.yaml/badge.svg)](https://github.com/arowM/tepa/actions/workflows/test.yaml)  
[Document](https://package.elm-lang.org/packages/arowM/tepa/latest/)  

![logo](https://user-images.githubusercontent.com/1481749/115139779-de382400-a06e-11eb-80e7-22af97774bfa.jpg)

TEPA（ティーパ）

バグのない、よいユーザー体験を生むウェブアプリケーションのためのフレームワーク

## 例外のないプログラミング

例外は、人類の発展を阻害する悪の発明です。確かに想定外のことは考えたくありません。後回しにしたいものです。その気持ちは痛いほど分かります。でもそうやって後になって困るのもあなた自身です。
考えてみてください。飛行機をつくるなら、ネジの1つ1つにいたるまで慎重に検品し、想定外の不具合があればその場で取り替えませんか？ 全部組み立てたあとで飛行機が落ちたとしても、もう何が原因だったのかなんてわかりません。例外処理とはそういう邪悪な技術です。

例外は静的型も台無しにします。TypeScriptを使ってJavaScriptにせっかく静的な型を導入しても、 `unknown` なんていう得体のしれない動的な型の値をあつかう必要があります。

TEPAでは、例外の存在しないElmという言語を採用しています。必ずその場で想定外の出来事に備えた対処をしないと、コンパイラーが許してくれません。最初は堅苦しく、鬱陶しく感じるかもしれません。でもいつの日か、その口うるさいコンパイラーに感謝する日がやってきます。

## シナリオに沿った記述

ウェブアプリケーションの主役はユーザーです。開発者でも運営者でもありません。ユーザーにとって使いにくいアプリケーションからは、ユーザーが離れていきます。ユーザーがいなければアプリケーションの開発を続けることができません。やがてあなたの会社は倒産し、あなたも露頭に迷います。

ですから、どのようなアプリケーションであれ、ユーザーの立場を考えなくてはなりません。もちろんそのユーザーがあなたの社内の人間で、とても深い洗脳状態にあり、一切文句を言わないのであれば、開発者が作りやすいだけの使いにくいアプリケーションも悪いものではありません。しかし、そういう狙いもなくユーザーを最初から一切無視して開発者の都合を押し付けることは意味が異なります。必ずユーザーについて考え、適切なアプリケーションのあり方を検討する必要があります。

そういったユーザーにとって使いやすいアプリケーションを作る上で欠かせないのがシナリオです。具体的なユーザーを想定して、そのユーザーがどんな気持ちでどんな操作をするのか想像します。そしてその操作に対してアプリケーションはどのようなフィードバックを与えればうまくいくのか考えていくのがシナリオです。それは明確に文字に起こされてチームで共有されることもあれば、設計者の脳内で無意識に行われていることもあります。
いずれにせよ、このシナリオに近い形でアプリケーションの挙動を記述できることが大切です。さもなくば、その書き方のギャップを埋めるために「翻訳」作業が必要になり、その過程でたくさんのバグが入ってしまいます。

でもね、なぜか人間さんはコンポーネントを主役にしたデータ中心な記述だとか、ステートレスだとか言って時間的な一連の操作の文脈すらなくしてしまったReducerだとか、賢いふりしてむしろ「翻訳」に起因するバグを増やしちゃっています。ちなみにTEPAを開発しているさくらちゃんは、ヤギさんです✌

TEPAでは、シナリオと近い時系列に沿った記述でアプリケーションを開発できます。

## シナリオが軽量なテストに

前述の通り、ユーザー中心なアプリケーションにはシナリオ作成が欠かせません。そこでTEPAはシナリオ作成機能を用意しました。この機能を使えば、プログラムとしてシナリオを作成できます。そのシナリオはブラウザーでいい感じに整形して表示することもできますし、Markdownとして出力することもできます。

さらに驚くべきは、シナリオがそのまま軽量なテストになるということです。TEPAでアプリケーションを書き、TEPAでシナリオを書くと、そのアプリケーションの挙動をエミュレートしてシナリオ通りの動作をしているかテストできます。このテストは実際のウェブブラウザーを使っているわけではありません。そのため瞬時に完了します。たとえば5億年スリープする処理が入っていても、一瞬です。5億年後も地球が存続していることに賭けてコールドスリープする必要はありません。アプリケーション内でのバックエンドサーバーへのリクエストや、乱数の生成なども、シナリオに期待する挙動を書いておけばその結果をアプリケーションに渡してテストが進みます。モックサーバーなどは必要ありません。

もちろん、エミュレーターであることにはデメリットもあります。実際に画面をレンダリングしているわけではないので、ビジュアルリグレッションテストなどはできません。重要な部分はなんかPlaywrightとかそういうのを併用しましょう。

## はじめかた

TEPAのチュートリアルは現在作成中です。でも、サンプルアプリケーションはすでに用意してあります。[spa-sampleディレクトリー](https://github.com/arowM/tepa/tree/main/spa-sample)の中身を参照してください。

[Elmの言語仕様](https://guide.elm-lang.jp/core_language.html)はすご〜く小さいのですぐに覚えられますし、型の助けを借りながらTEPAの[モジュールドキュメント](https://package.elm-lang.org/packages/arowM/tepa/latest/Tepa)を読めば `spa-sample` の構造が理解できるようになるはずです。

人間さんっていう生き物は、最新の技術ばかり追いかけて消耗するのが大好きですよね？ チュートリアルなんか待たずに早く手を出して他のプログラマーと差をつけましょう！
